import streamlit as st
import pandas as pd
from datetime import datetime
import arabic_reshaper
from bidi.algorithm import get_display

# --- ุฏุงูุฉ ูุนุงูุฌุฉ ุงููุตูุต ุงูุนุฑุจูุฉ ---
def fix_arabic(text):
    if not text:
        return ""
    reshaped_text = arabic_reshaper.reshape(text)
    return get_display(reshaped_text)

class SiteRentalValuation:
    """ูุธุงู ุชุญุฏูุฏ ุงููููุฉ ุงูุฅูุฌุงุฑูุฉ ูููููุน ุงููุชูุงูู ูุน ุงูููุงุฆุญ ุงูุจูุฏูุฉ"""
    
    def __init__(self):
        self.valuation_factors = {
            'location_factor': 1.2,
            'area_factor': 1.0,
            'zoning_factor': 1.1
        }

    def render_valuation(self):
        """ุงูุฏุงูุฉ ุงูุฃุณุงุณูุฉ ูุนุฑุถ ูุงุฌูุฉ ุงูุชูููู"""
        st.subheader("๐ ุชูููู ุงููููุฉ ุงูุฅูุฌุงุฑูุฉ ููููุงูุน")
        
        with st.container():
            col1, col2 = st.columns(2)
            with col1:
                base_price = st.number_input("ุงูุณุนุฑ ุงูุฃุณุงุณู ูููุชุฑ (ุฑูุงู)", min_value=0.0, value=100.0)
                site_area = st.number_input("ูุณุงุญุฉ ุงููููุน ุงูุฅุฌูุงููุฉ (ูยฒ)", min_value=0.0, value=500.0)
            
            with col2:
                site_type = st.selectbox("ููุน ุงููููุน", ["ุชุฌุงุฑู", "ุณููู", "ุตูุงุนู", "ุฒุฑุงุนู"])
                duration = st.number_input("ูุฏุฉ ุงูุนูุฏ (ุณููุงุช)", min_value=1, value=10)

            total_value = base_price * site_area * duration
            st.metric("ุฅุฌูุงูู ุงููููุฉ ุงูุชูุฏูุฑูุฉ", f"{total_value:,.2f} ุฑูุงู")

            if st.button("๐ ุชูููุฏ ูุณูุฏุฉ ุงูุงุชูุงููุฉ"):
                self.show_agreement_preview(total_value, site_type)

    def show_agreement_preview(self, value, s_type):
        """ุนุฑุถ ูุณูุฏุฉ ุงูุงุชูุงููุฉ ูุน ุฅุบูุงู ุงููุต ุจุดูู ุตุญูุญ"""
        
        # ุงูุณุทุฑ 1064 ุงูุฐู ูุงู ูุณุจุจ ุงููุดููุฉ (ุชู ุฅุตูุงุญู ูุฅุบูุงูู)
        agreement_template = f"""
        ุนูุฏ ุชุฃุฌูุฑ ูููุน ุนูุงุฑู ุจูุฏู
        --------------------------
        ุจูุงุกู ุนูู ููุงุฆุญ ุงูุชุตุฑู ุจุงูุนูุงุฑุงุช ุงูุจูุฏูุฉุ ุชู ุงูุงุชูุงู ุนูู ูุง ููู:
        
        1. ููุถูุน ุงูุนูุฏ: ุชุฃุฌูุฑ ูููุน {s_type}.
        2. ุงููููุฉ ุงูุฅูุฌุงุฑูุฉ ุงูุฅุฌูุงููุฉ: {value:,.2f} ุฑูุงู ุณุนูุฏู.
        3. ูุฏุฉ ุงูุนูุฏ: ุชุฎุถุน ูููุฏุฏ ุงููุญุฏุฏุฉ ูู ุงููุงุฏุฉ 21 ูู ุงููุงุฆุญุฉ.
        
        ุงูุดุฑูุท ุงูุนุงูุฉ:
        - ููุชุฒู ุงููุณุชุฃุฌุฑ ุจุงุณุชุฎุฏุงู ุงููููุน ุญุณุจ ุงูุบุฑุถ ุงููุฎุตุต.
        - ูุฎุถุน ูุฐุง ุงูุนูุฏ ูุฃูุธูุฉ ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ ูููุงุฆุญ ุงููุฒุงุฑุฉ.
        
        ุชูููุน ุงูุทุฑู ุงูุฃูู (ุงููุคุฌุฑ): _________________
        ุชูููุน ุงูุทุฑู ุงูุซุงูู (ุงููุณุชุฃุฌุฑ): _________________
        """ # <--- ุชู ุฅุบูุงู ุงููุต ููุง ุจู ุซูุงุซ ุนูุงูุงุช ุงูุชุจุงุณ ูุถูุงู ุนุฏู ุญุฏูุซ SyntaxError
        
        st.text_area("ูุณูุฏุฉ ุงูุงุชูุงููุฉ", value=agreement_template, height=300)

# ููุงูุฉ ุงูููุงุณ SiteRentalValuation
